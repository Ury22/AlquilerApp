@model IEnumerable<AlquilerApp.Models.Alquiler>

@{
ViewData["Title"] = "Gestión de Contratos de Alquiler";
}


<div class="bg-light p-4 p-sm-6 p-lg-8" style="min-height: 100vh; background-image: linear-gradient(to bottom right, #f8f9fa, #e0f7fa);">
<div class="container-xxl">

    <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4 mb-md-5">
        <div class="d-flex align-items-center">
            <div class="bg-white p-3 rounded-3 shadow-lg me-4">
                <i class="fas fa-file-contract text-fuchsia-600 fs-4" style="color: #d946ef;"></i>
            </div>
            <div>
                <h1 class="h3 fw-bold text-dark mb-0">
                    @ViewData["Title"]
                </h1>
                <p class="text-muted mt-1 mb-0">Administra todos los contratos de alquiler activos</p>
            </div>
        </div>

        <a asp-action="Create"
           class="mt-3 mt-md-0 btn btn-lg btn-primary fw-bold px-4 shadow-lg text-white"
           style="background-image: linear-gradient(to right, #0ea5e9, #3b82f6); border: none;">
            <i class="fas fa-plus me-2"></i> Nuevo Contrato
        </a>
    </div>

    @* Tarjetas de Resumen (Sin cambios) *@
    <div class="row g-4 mb-5">
        
        <div class="col-12 col-md-3">
            <div class="card p-3 shadow-sm border-start border-5 border-success rounded-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted fw-medium mb-1">Contratos Activos</p>
                        <p class="h4 fw-bold text-dark mb-0">@Model.Count(a => a.Estado?.EstadoNombre == "Activo")</p>
                    </div>
                    <div class="bg-success-subtle p-3 rounded-circle">
                        <i class="fas fa-check-circle text-success fs-5"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-md-3">
            <div class="card p-3 shadow-sm border-start border-5 border-warning rounded-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted fw-medium mb-1">Contratos Pendientes</p>
                        <p class="h4 fw-bold text-dark mb-0">@Model.Count(a => a.Estado?.EstadoNombre == "Pendiente")</p>
                    </div>
                    <div class="bg-warning-subtle p-3 rounded-circle">
                        <i class="fas fa-clock text-warning fs-5"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-md-3">
            <div class="card p-3 shadow-sm border-start border-5 border-primary rounded-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted fw-medium mb-1">Total Contratos</p>
                        <p class="h4 fw-bold text-dark mb-0">@Model.Count()</p>
                    </div>
                    <div class="bg-primary-subtle p-3 rounded-circle">
                        <i class="fas fa-file-alt text-primary fs-5"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-12 col-md-3">
            <div class="card p-3 shadow-sm border-start border-5 border-info rounded-3">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <p class="text-muted fw-medium mb-1">Ingreso Mensual (Activo)</p>
                        <p class="h4 fw-bold text-dark mb-0">@Model.Where(a => a.Estado?.EstadoNombre == "Activo").Sum(a => a.CuotaMensual).ToString("C")</p>
                    </div>
                    <div class="bg-info-subtle p-3 rounded-circle">
                        <i class="fas fa-dollar-sign text-info fs-5"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @* Tabla de Contratos *@
    <div class="card shadow-lg rounded-4 overflow-hidden border-0">
        <div class="card-header bg-light border-bottom p-4">
            <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                <h2 class="h5 fw-semibold text-gray-800 mb-2 mb-md-0">Lista de Contratos</h2>
                
                @* Se elimina el input de búsqueda *@
                <div class="d-flex flex-wrap gap-2">
                    <select class="form-select" style="width: auto;">
                        <option>Todos los estados</option>
                        <option>Activo</option>
                        <option>Pendiente</option>
                        <option>Finalizado</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th scope="col" class="py-3 px-4 text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            <div class="d-flex align-items-center"><span>Código</span><i class="fas fa-sort ms-1 text-muted" style="cursor: pointer;"></i></div>
                        </th>
                        <th scope="col" class="py-3 px-4 text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            Inquilino
                        </th>
                        <th scope="col" class="py-3 px-4 text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            Vigencia
                        </th>
                        <th scope="col" class="py-3 px-4 text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            <div class="d-flex align-items-center"><span>Cuota Mensual</span><i class="fas fa-sort ms-1 text-muted" style="cursor: pointer;"></i></div>
                        </th>
                        <th scope="col" class="py-3 px-4 text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            Estado
                        </th>
                        <th scope="col" class="py-3 px-4 text-center text-uppercase text-muted fw-semibold" style="font-size: 0.75rem;">
                            Acciones
                        </th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model)
                    {
                        var nombres = item.InquilinoPersona?.Nombres ?? "N/A";
                        var apellidos = item.InquilinoPersona?.Apellidos ?? "";
                        var inicial = nombres.Length > 0 ? nombres[0].ToString() : "?";
                        string estadoNombre = item.Estado?.EstadoNombre ?? "Desconocido";

                        string estadoClass = estadoNombre switch {
                            "Activo" => "bg-success-subtle text-success",
                            "Pendiente" => "bg-warning-subtle text-warning",
                            "Finalizado" => "bg-secondary-subtle text-secondary",
                            _ => "bg-danger-subtle text-danger"
                        };

                        // Verificar si el contrato está próximo a vencer
                        bool proximoVencer = item.FechaFinalizacion <= DateTime.Now.AddDays(30) && item.FechaFinalizacion > DateTime.Now;

                        <tr class="@(proximoVencer ? "table-warning border-start border-5 border-warning" : "")">
                            
                            <td class="px-4 py-3">
                                <div class="d-flex align-items-center">
                                    <div class="bg-primary-subtle p-2 rounded me-3">
                                        <i class="fas fa-hashtag text-primary-emphasis fs-6"></i>
                                    </div>
                                    <span class="text-sm fw-bold text-dark">@item.CodAlquiler</span>
                                </div>
                            </td>

                            <td class="px-4 py-3">
                                <div class="d-flex align-items-center">
                                    <div class="flex-shrink-0 me-3">
                                        <div class="rounded-circle d-flex align-items-center justify-content-center fw-bold text-white fs-5 shadow" 
                                             style="width: 40px; height: 40px; background-image: linear-gradient(to top right, #d946ef, #9333ea);">
                                            @inicial
                                        </div>
                                    </div>
                                    <div>
                                        <div class="fw-semibold text-dark">
                                            @nombres @apellidos
                                        </div>
                                        <div class="text-xs text-muted">
                                            <i class="far fa-envelope me-1"></i> contacto@ejemplo.com @* Placeholder de correo *@
                                        </div>
                                    </div>
                                </div>
                            </td>

                            <td class="px-4 py-3">
                                <div class="d-flex flex-column">
                                    <span class="text-sm text-dark d-flex align-items-center">
                                        <i class="far fa-calendar-check text-success me-2" style="font-size: 0.85rem;"></i>
                                        Inicio: @item.FechaInicio.ToString("dd MMM yyyy")
                                    </span>
                                    <span class="text-sm @(proximoVencer ? "text-warning fw-bold" : "text-muted") d-flex align-items-center mt-1">
                                        <i class="far fa-calendar-times me-2" style="font-size: 0.85rem;"></i>
                                        Fin: @item.FechaFinalizacion.ToString("dd MMM yyyy")
                                        @if (proximoVencer)
                                        {
                                            <span class="badge text-bg-warning-subtle text-warning fw-semibold ms-2" style="font-size: 0.7rem;">Vence pronto</span>
                                        }
                                    </span>
                                </div>
                            </td>

                            <td class="px-4 py-3">
                                <div class="fw-bolder text-success fs-5 d-flex align-items-center">
                                    <i class="fas fa-dollar-sign text-success me-1 fs-6"></i>
                                    @item.CuotaMensual.ToString("C")
                                </div>
                                <div class="text-xs text-muted">Por mes</div>
                            </td>

                            <td class="px-4 py-3">
                                <span class="badge rounded-pill fw-bold @estadoClass p-2" style="font-size: 0.8em;">
                                    @estadoNombre
                                </span>
                            </td>

                            @* *** CAMBIO CLAVE: Botones con texto en lugar de solo iconos *** *@
                            <td class="px-4 py-3 text-center">
                                <div class="d-flex justify-content-center gap-2">
                                    
                                    <a asp-action="Edit" asp-route-id="@item.CodAlquiler"
                                       title="Editar contrato"
                                       class="btn btn-sm btn-primary fw-bold shadow-sm d-flex align-items-center">
                                        <i class="fas fa-edit me-1"></i> Editar
                                    </a>

                                    <a asp-action="Details" asp-route-id="@item.CodAlquiler"
                                       title="Ver detalles"
                                       class="btn btn-sm fw-bold shadow-sm d-flex align-items-center"
                                       style="background-color: #d946ef; border-color: #d946ef; color: white;">
                                        <i class="fas fa-eye me-1"></i> Detalles
                                    </a>

                                    <a asp-action="Delete" asp-route-id="@item.CodAlquiler"
                                       title="Eliminar contrato"
                                       class="btn btn-sm btn-danger fw-bold shadow-sm d-flex align-items-center">
                                        <i class="fas fa-trash-alt me-1"></i> Eliminar
                                    </a>
                                </div>
                            </td>

                        </tr>
                    }
                </tbody>
            </table>
        </div>

        @if (!Model.Any())
        {
            <div class="text-center py-5">
                <div class="mx-auto" style="max-width: 400px;">
                    <div class="bg-primary-subtle w-20 h-20 rounded-circle d-flex align-items-center justify-content-center mx-auto mb-4" style="width: 80px; height: 80px;">
                        <i class="fas fa-file-contract text-primary fs-3"></i>
                    </div>
                    <h3 class="h5 fw-semibold text-dark mb-2">No hay contratos registrados</h3>
                    <p class="text-muted mb-4">Comienza creando tu primer contrato de alquiler.</p>
                    <a asp-action="Create" class="btn btn-primary fw-medium px-4 shadow">
                        <i class="fas fa-plus me-2"></i> Crear primer contrato
                    </a>
                </div>
            </div>
        }
        else
        {
            <div class="card-footer bg-light border-top p-4 d-flex flex-column flex-md-row align-items-md-center justify-content-between">
                <div class="text-sm text-muted mb-3 mb-md-0">
                    Mostrando <span class="fw-semibold">1</span> a <span class="fw-semibold">@Model.Count()</span> de <span class="fw-semibold">@Model.Count()</span> resultados
                </div>
                <nav>
                    <ul class="pagination pagination-sm mb-0">
                        <li class="page-item disabled"><a class="page-link" href="#">Anterior</a></li>
                        <li class="page-item active"><a class="page-link" href="#">1</a></li>
                        <li class="page-item disabled"><a class="page-link" href="#">Siguiente</a></li>
                    </ul>
                </nav>
            </div>
        }

    </div>

</div>


</div>